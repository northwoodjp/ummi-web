<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Check-in Kehadiran | Masjid UMMI</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<section class="checkin-section fade">
  <h2 class="section-title">Check-in Kehadiran</h2>
  <p id="status" style="text-align:center; margin-top:1rem;">Memproses...</p>
</section>

<script>
// Ambil ID dari URL
const params = new URLSearchParams(window.location.search);
const registrationId = params.get("id");
const statusEl = document.getElementById("status");

if(!registrationId){
  statusEl.textContent = "ID tidak ditemukan. QR code invalid.";
} else {

  // Kirim ke Google Apps Script untuk update check-in
  const payload = { id: registrationId, checkin: new Date().toISOString() };

  fetch("https://script.google.com/macros/s/AKfycbwSqprQxi5nE9qd9tZxBNNHzSg0S0KzA_Kw8AbEWjuKMJrkGsvtSQ2HNjkbjTViul9lLg/exec", {
    method: "POST",
    body: JSON.stringify(payload),
    headers: { "Content-Type": "text/plain;charset=utf-8" }
  })
  .then(res => res.json())
  .then(result => {
    if(result.status==="success"){
      statusEl.innerHTML = `<strong>Check-in berhasil!</strong><br>ID: ${registrationId}<br>Terimakasih atas kehadiran Anda.`;
    } else {
      statusEl.textContent = "Gagal check-in: " + result.message;
    }
  })
  .catch(err => {
    statusEl.textContent = "Terjadi error: " + err.message;
  });
}
</script>

</body>
</html>