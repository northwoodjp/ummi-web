<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pendaftaran Kehadiran | Masjid UMMI</title>

  <link rel="stylesheet" href="style.css" />
  <script src="script.js" defer></script>
</head>
<body>

<!-- ==================== NAVIGATION ==================== -->
<nav>
  <div class="nav-inner">
    <a href="index.html" class="nav-logo">Masjid UMMI</a>
    <div class="hamburger" onclick="toggleMenu()">☰</div>
    <div class="nav-links" id="nav">
      <a href="index.html#about">Tentang</a>
      <a href="index.html#support">Dukung</a>
      <a href="index.html#location">Lokasi</a>
      <a href="index.html#follow">Ikuti</a>
      <a href="contact.html">Hubungi Kami</a>
    </div>
  </div>
</nav>

<!-- ==================== PAGE HEADER ==================== -->
<section class="donation-instructions fade">
  <h2 class="section-title">Kajian Bersama Ust. Handy Bonny</h2>
  <p class="donation-subtitle">
    Mohon isi data kehadiran untuk membantu panitia mempersiapkan acara. <strong>Batas waktu pendaftaran hingga 7 Maret 2026 pukul 12:00 AM JST.</strong>
  </p>

  <form class="donation-form" id="registrationForm">

    <!-- Nama -->
    <div class="form-group">
      <label>Nama</label>
      <input type="text" name="nama" placeholder="Nama lengkap" required />
    </div>

    <!-- Jumlah Hadir -->
    <div class="form-group">
      <div class="form-group">
  <label>Jumlah yang Hadir</label>

  <!-- Dewasa -->
  <div style="margin-bottom:1rem;">
    <label style="font-weight:500;">Dewasa</label>
    <div style="display:flex; gap:1rem;">
      
      <div>
        <label style="font-size:0.8rem;">L</label>
        <select name="dewasa_l" required>
          <option value="0">0</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
        </select>
      </div>

      <div>
        <label style="font-size:0.8rem;">P</label>
        <select name="dewasa_p" required>
          <option value="0">0</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
        </select>
      </div>

    </div>
  </div>

  <!-- Anak -->
  <div>
    <label style="font-weight:500;">Anak</label>
    <div style="display:flex; gap:1rem;">
      
      <div>
        <label style="font-size:0.8rem;">L</label>
        <select name="anak_l">
          <option value="0">0</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
        </select>
      </div>

      <div>
        <label style="font-size:0.8rem;">P</label>
        <select name="anak_p">
          <option value="0">0</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
        </select>
      </div>

    </div>
  </div>

</div>
    <!-- ==================== CHILDREN ==================== -->
<div class="form-group">
  <label>Jumlah Anak</label>
  <select id="jumlahAnak" name="jumlah_anak">
    <option value="">Pilih</option>
    <option value="0">Tidak ada</option>
    <option value="1">1 Anak</option>
    <option value="2">2 Anak</option>
    <option value="3">3 Anak</option>
    <option value="4">4 Anak</option>
    <option value="5">5 Anak</option>
  </select>
</div>

<!-- ==================== USIA ANAK ==================== -->
<div class="form-group" id="usiaAnakGroup" style="display:none;">
  <label>Usia Anak</label>

  <div id="usiaContainer" style="display:flex; flex-direction:column; gap:10px;"></div>

  <input type="hidden" name="usia_anak" id="usiaAnakGabungan">
</div>


<div class="form-group">
  <label>Transportasi</label>

  <div style="display:flex; gap:1rem;">
    <label>
      <input type="radio" name="transportasi" value="Umum" required>
      Umum
    </label>

    <label>
      <input type="radio" name="transportasi" value="Pribadi" required>
      Pribadi
    </label>
  </div>
</div>

    <!-- Catatan -->
    <div class="form-group">
      <label>Catatan (Opsional)</label>
      <textarea name="catatan" rows="4" placeholder="Contoh: alergi, kebutuhan khusus, dll"></textarea>
    </div>

    <button type="submit" class="donation-btn">
      Kirim Pendaftaran
    </button>

  </form>
</section>

<!-- ==================== FOOTER ==================== -->
<footer>
  <p>
    <br><br>
    “Whoever builds a masjid for Allah,
    Allah will build for him a house in Paradise.”
    <br>— Prophet Muhammad ﷺ
    <br><br>
    © UMMI Masjid · ummi.jp · info@ummi.jp
  </p>
</footer>

<!-- ==================== SCRIPT ==================== -->
<script>
const form = document.getElementById("registrationForm");
const anakL = document.getElementById("anakL");
const anakP = document.getElementById("anakP");
const usiaGroup = document.getElementById("usiaAnakGroup");
const usiaContainer = document.querySelector(".usia-container");
const usiaHidden = document.getElementById("usiaAnakGabungan");

/* Generate input usia */
function updateUsiaInputs() {
  const jumlah = (parseInt(anakL.value) || 0) + (parseInt(anakP.value) || 0);

  usiaContainer.innerHTML = "";

  if (jumlah > 0) {
    usiaGroup.style.display = "block";

    for (let i = 0; i < jumlah; i++) {
      const input = document.createElement("input");
      input.type = "number";
      input.min = "0";
      input.placeholder = `Usia Anak ${i + 1}`;
      input.classList.add("usia-anak");
      input.required = true;

      usiaContainer.appendChild(input);
    }
  } else {
    usiaGroup.style.display = "none";
  }
}

/* Trigger saat jumlah anak berubah */
anakL.addEventListener("input", updateUsiaInputs);
anakP.addEventListener("input", updateUsiaInputs);

/* Submit */
form.addEventListener("submit", async e => {
  e.preventDefault();

  const inputs = document.querySelectorAll(".usia-anak");
  let usiaList = [];

  inputs.forEach(input => {
    if (input.value !== "") {
      usiaList.push(input.value.trim());
    }
  });

  // validasi
  if (inputs.length > 0 && usiaList.length < inputs.length) {
    alert("Harap isi semua usia anak");
    return;
  }

  usiaHidden.value = usiaList.join(",");

  const btn = form.querySelector("button");
  btn.disabled = true;
  btn.textContent = "Mengirim...";

  try {
    const formData = new FormData(form);
    const payload = {};

    for (let [k, v] of formData.entries()) {
      payload[k] = v;
    }

    payload.timestamp = new Date().toISOString();

    const res = await fetch("https://script.google.com/macros/s/AKfycbwSqprQxi5nE9qd9tZxBNNHzSg0S0KzA_Kw8AbEWjuKMJrkGsvtSQ2HNjkbjTViul9lLg/exec", {
      method: "POST",
      body: JSON.stringify(payload),
      headers: { "Content-Type": "text/plain;charset=utf-8" },
    });

    const result = await res.json();
    if (result.status !== "success") throw new Error(result.message);

    window.location.href = `terimakasih2.html?ref=${Date.now()}`;

  } catch (err) {
    alert("Gagal mengirim: " + err.message);
  } finally {
    btn.disabled = false;
    btn.textContent = "Kirim Pendaftaran";
  }
});
</script>

</body>
</html>
